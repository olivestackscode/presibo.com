<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Health Search - Presibo AI</title>
  <meta name="description" content="Ask any health-related question and get AI-powered answers from Presibo's advanced medical intelligence system." />
  
  <!-- Favicons -->
  <link href="assets/img/presibo-logo.jpg" rel="icon">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  
  <!-- Template Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  
  <style>
    .search-hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 120px 0 60px;
    }
    
    .search-container {
      max-width: 800px;
      margin: -50px auto 0;
      padding: 30px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 3;
    }
    
    .search-input {
      width: 100%;
      padding: 20px 60px 20px 20px;
      border: 2px solid #e0e8ff;
      border-radius: 15px;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
      resize: vertical;
      min-height: 60px;
    }
    
    .search-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .search-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 10px;
      cursor: pointer;
    }
    
    .search-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .response-container {
      margin-top: 30px;
      padding: 25px;
      background: #f8f9ff;
      border-radius: 15px;
      border-left: 4px solid #667eea;
      display: none;
    }
    
    .loading-container {
      display: none;
      text-align: center;
      padding: 30px;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #e0e8ff;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .question-card {
      background: white;
      border: 1px solid #e0e8ff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .question-card:hover {
      border-color: #667eea;
      transform: translateY(-2px);
    }
    
    .error-container {
      margin-top: 20px;
      padding: 20px;
      background: #fff5f5;
      border: 1px solid #fed7d7;
      border-radius: 10px;
      color: #c53030;
      display: none;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center">
        <h1>Presibo</h1>
      </a>
      <nav id="navbar" class="navbar">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="about">About</a></li>
          <li><a href="doctors">Doctors</a></li>
          <li><a href="elders">Elder Care</a></li>
          <li><a href="https://app.presibo.com">Login</a></li>
          <li><a class="get-a-quote" href="https://app.presibo.com/join">Sign Up</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="search-hero">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8 mx-auto text-center">
          <h1 class="display-4 mb-4">Ask Presibo AI</h1>
          <p class="lead mb-4">Get instant, AI-powered answers to your health questions</p>
        </div>
      </div>
    </div>
  </section>

  <main id="main">
    <!-- Search Container -->
    <section class="py-5">
      <div class="container">
        <div class="search-container">
          <div class="position-relative mb-3">
            <textarea 
              id="searchInput" 
              class="search-input" 
              placeholder="Ask any health question... e.g., 'What are the symptoms of high blood pressure?'"
              rows="3"
            ></textarea>
            <button id="searchBtn" class="search-btn">
              <i class="fas fa-search"></i>
            </button>
          </div>

          <!-- Loading Container -->
          <div id="loadingContainer" class="loading-container">
            <div class="loading-spinner"></div>
            <p>Analyzing your question with AI...</p>
          </div>

          <!-- Response Container -->
          <div id="responseContainer" class="response-container">
            <div class="d-flex align-items-center mb-3">
              <div class="bg-primary text-white rounded-circle p-2 me-3">
                <i class="fas fa-robot"></i>
              </div>
              <h5 class="mb-0">Presibo AI Response</h5>
            </div>
            <div id="responseContent"></div>
          </div>

          <!-- Error Container -->
          <div id="errorContainer" class="error-container">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span id="errorMessage"></span>
          </div>

          <!-- Sample Questions -->
          <div class="mt-4">
            <h5>Try These Sample Questions:</h5>
            <div class="row">
              <div class="col-lg-6">
                <div class="question-card" onclick="askQuestion('What are the early warning signs of diabetes?')">
                  <small class="text-primary">DIABETES</small>
                  <p class="mb-0">What are the early warning signs of diabetes?</p>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="question-card" onclick="askQuestion('How can I lower my blood pressure naturally?')">
                  <small class="text-primary">CARDIOVASCULAR</small>
                  <p class="mb-0">How can I lower my blood pressure naturally?</p>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="question-card" onclick="askQuestion('What foods should I eat for better heart health?')">
                  <small class="text-primary">NUTRITION</small>
                  <p class="mb-0">What foods should I eat for better heart health?</p>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="question-card" onclick="askQuestion('How can I improve my sleep quality?')">
                  <small class="text-primary">WELLNESS</small>
                  <p class="mb-0">How can I improve my sleep quality?</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Disclaimer -->
          <div class="mt-4 p-3 bg-warning bg-opacity-10 border border-warning rounded">
            <h6><i class="fas fa-info-circle me-2"></i>Medical Disclaimer</h6>
            <small>This information is for educational purposes only. Always consult healthcare providers for medical advice.</small>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer id="footer" class="footer">
    <div class="container">
      <div class="row gy-4">
        <div class="col-lg-6 footer-info">
          <a href="index.html" class="logo d-flex align-items-center">
            <span>Presibo Health Search</span>
          </a>
          <p>Get instant, AI-powered answers to your health questions with advanced medical intelligence.</p>
        </div>
        <div class="col-lg-3 footer-links">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about">About</a></li>
            <li><a href="doctors">Find Doctors</a></li>
            <li><a href="elders">Elder Care</a></li>
          </ul>
        </div>
        <div class="col-lg-3 footer-contact">
          <h4>Contact Us</h4>
          <p><strong>Phone:</strong> +234 703 281 0862<br>
          <strong>Email:</strong> info@presibo.com</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="assets/js/config.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
    // Get API configuration from environment config
    const anthropicConfig = window.PresiboConfig.getAnthropicConfig();
    
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const loadingContainer = document.getElementById('loadingContainer');
    const responseContainer = document.getElementById('responseContainer');
    const responseContent = document.getElementById('responseContent');
    const errorContainer = document.getElementById('errorContainer');
    const errorMessage = document.getElementById('errorMessage');

    searchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        performSearch();
      }
    });

    searchBtn.addEventListener('click', performSearch);

    async function performSearch() {
      const query = searchInput.value.trim();
      
      if (!query) {
        showError('Please enter a health question.');
        return;
      }

      hideAllContainers();
      showLoading(true);
      disableSearch(true);

      try {
        const response = await callAnthropicAPI(query);
        showResponse(response);
      } catch (error) {
        showError('Unable to process your question. Please try again.');
      } finally {
        showLoading(false);
        disableSearch(false);
      }
    }

    async function callAnthropicAPI(query) {
      // Check if AI search is enabled
      if (!window.PresiboConfig.isFeatureEnabled('AI_SEARCH')) {
        throw new Error('AI search feature is currently disabled');
      }
      
      const prompt = `You are Presibo AI, a medical AI assistant for Nigerian healthcare. 

User Question: "${query}"

Provide a helpful response with:
1. Direct answer to the question
2. Medical information based on current guidelines
3. Practical recommendations
4. When to seek professional care

Keep responses clear and educational. Always recommend consulting healthcare professionals for diagnosis/treatment.`;

      const response = await fetch(anthropicConfig.apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': anthropicConfig.apiKey,
          'anthropic-version': '2023-06-01'
        },
        body: JSON.stringify({
          model: anthropicConfig.model,
          max_tokens: 1000,
          messages: [{
            role: 'user',
            content: prompt
          }]
        })
      });

      if (!response.ok) {
        throw new Error('API request failed');
      }

      const data = await response.json();
      return data.content[0].text;
    }

    function askQuestion(question) {
      searchInput.value = question;
      performSearch();
    }

    function showResponse(content) {
      hideAllContainers();
      responseContent.innerHTML = formatResponse(content);
      responseContainer.style.display = 'block';
    }

    function showError(message) {
      hideAllContainers();
      errorMessage.textContent = message;
      errorContainer.style.display = 'block';
    }

    function showLoading(show) {
      loadingContainer.style.display = show ? 'block' : 'none';
    }

    function disableSearch(disable) {
      searchBtn.disabled = disable;
      searchInput.disabled = disable;
    }

    function hideAllContainers() {
      responseContainer.style.display = 'none';
      errorContainer.style.display = 'none';
      loadingContainer.style.display = 'none';
    }

    function formatResponse(text) {
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>')
        .replace(/^/, '<p>')
        .replace(/$/, '</p>');
    }

    // Initialize AOS
    AOS.init();
    
    // Handle URL parameters for pre-filled questions
    window.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const question = urlParams.get('q');
      
      if (question) {
        searchInput.value = question;
        // Auto-perform search for pre-filled questions
        setTimeout(() => {
          performSearch();
        }, 500);
      }
    });
  </script>
</body>
</html>
